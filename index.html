<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>شراء توكن NIXEL</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
    button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
    input { padding: 8px; width: 100px; }
  </style>
</head>
<body>

<h2>شراء توكن NIXEL (NIX)</h2>

<div>
  <button id="connectWallet">ربط المحفظة</button>
  <p id="walletAddress">لم يتم الربط بعد</p>
</div>

<div>
  <label>كمية BNB للشراء:</label>
  <input type="number" id="bnbAmount" placeholder="0.1" min="0.001" step="0.001" />
</div>

<div>
  <button id="buyTokens">شراء</button>
</div>

<p id="status"></p>

<script>
  const contractAddress = "0xC89334a5aa130C6E9162cF45Db33168d078eFE80"; // عنوان العقد الخاص بك
  let provider;
  let signer;
  let userAddress;

  async function connectWallet() {
    if (window.ethereum) {
      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "المحفظة متصلة: " + userAddress;
        document.getElementById("status").innerText = "";
      } catch (err) {
        document.getElementById("status").innerText = "رفض ربط المحفظة";
      }
    } else {
      alert("يرجى تثبيت MetaMask");
    }
  }

  async function buyTokens() {
    if (!signer) {
      alert("يرجى ربط المحفظة أولاً");
      return;
    }

    let bnbAmount = document.getElementById("bnbAmount").value;
    if (!bnbAmount || bnbAmount <= 0) {
      alert("أدخل كمية صحيحة من BNB");
      return;
    }

    try {
      const tx = await signer.sendTransaction({
        to: contractAddress,
        value: ethers.utils.parseEther(bnbAmount)
      });

      document.getElementById("status").innerText = "تم إرسال المعاملة، رقمها: " + tx.hash;
      await tx.wait();
      document.getElementById("status").innerText = "تمت عملية الشراء بنجاح!";
    } catch (error) {
      document.getElementById("status").innerText = "خطأ في المعاملة: " + error.message;
    }
  }

  document.getElementById("connectWallet").addEventListener("click", connectWallet);
  document.getElementById("buyTokens").addEventListener("click", buyTokens);
</script>

</body>
</html>
